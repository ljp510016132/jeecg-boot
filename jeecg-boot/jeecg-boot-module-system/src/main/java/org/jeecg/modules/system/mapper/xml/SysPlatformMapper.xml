<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.system.mapper.SysPlatformMapper">
    <select id="queryUserPlatforms" parameterType="String" resultType="org.jeecg.modules.system.entity.SysPlatform">
        select * from sys_platform
        <!--如果用户名为空，则查询所有平台信息-->
        <if test="!superAdmin">
        where platform_code in (
                   SELECT DISTINCT platform_code
                   FROM  sys_permission p
                   WHERE exists(
                        select a.id from sys_role_permission a
                        join sys_role b on a.role_id = b.id
                        join sys_user_role c on c.role_id = b.id
                        join sys_user d on d.id = c.user_id
                        where p.id = a.permission_id AND d.id = #{userId}
                   )
                   and p.del_flag = 0
        )
        </if>
    </select>
</mapper>